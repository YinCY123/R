---
title: "P2y12r and C1q"
author: "yincy"
date: "9/14/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, message=FALSE, warning=FALSE, echo=FALSE}
library(tidyverse)
library(nichenetr)
library(EnsDb.Mmusculus.v79)
```


# C1q and C3 promotors  
```{r}
mgs <- genes(EnsDb.Mmusculus.v79)

C1q <- mgs[grep("^C1q", mgs$gene_name, ignore.case = T)]$gene_name %>% unique()
C1q

write.csv(x = c(C1q, "C3") %>% sort(), 
            file = "C1 and C3 genes.csv", 
          row.names = F, quote = F)
```

```{r}
load(file = "f:/git/nichenetr/data/gr_network.rda")

# convert from human to muse symbol
gr_network$from <- gr_network$from %>% convert_human_to_mouse_symbols()
gr_network$to <- gr_network$to %>% convert_human_to_mouse_symbols()

gr_network <- gr_network %>% 
    dplyr::filter(!is.na(from), !is.na(to))

gr_network %>% 
    dplyr::filter(toupper(to) %in% toupper(c(C1q, "C3"))) %>% 
    dplyr::select(from, to) %>% 
    arrange(to) %>% 
    magrittr::set_colnames(value = c("regulator", "target")) %>% 
    write.csv(file = "C1C3-regulators.csv", 
                row.names = F, quote = F)
```


# P2y12r signaling network  
```{r, message=F, }
library(KEGGREST)
library(reactome.db)
library(rWikiPathways)
library(pathview)
```


## PVN  
```{r}
pvn <- read.csv(file = "20200702_frame_tpm_coding_gene_PVN.csv", 
                row.names = 1)
pvn
```

```{r}
AngII_14 <- grep("14A", colnames(pvn), value = T)
LNAME_14 <- grep("14L", colnames(pvn), value = T)
AngII_3 <- grep("3A", colnames(pvn), value = T)
LNAME_3 <- grep("3L", colnames(pvn), value = T)
naive <- grep("naive", colnames(pvn), value = T)



```





## map p2y12r onto KEGG pathways  
```{r}
p2ry12_entrez <- "70839"
mgs[grep("p2ry12", mgs$gene_name, ignore.case = T, value = F)]
```


```{r}
listDatabases()
keggLink(target = "pathway", source = paste("mmu:", p2ry12_entrez, sep = ""))


```


```{r}
getNodeSet(doc = kegg_mmu04611_parsed, 
           path = "//entry")

names <- c("id", "name", "type")

df <- data.frame()

for(name in names){
    x <- do.call(what = "xpathSApply", 
            args = list(
                doc = kegg_mmu04611_parsed,
                path = "//entry", 
                fun = xmlGetAttr, 
                name = name
            ))
    df <- rbind(df, x)
}


df <- t(df) %>% as.data.frame() %>% 
    magrittr::set_colnames(value = c("id", "name", "type"))
rownames(df) <- NULL
df <- df %>% 
    dplyr::filter(name != "undefined")
```

```{r}
relations <- c("entry1", "entry2", "type")
relation_df <- data.frame()
for(relation in relations){
    x <- do.call(what = "xpathSApply", 
            args = list(
                doc = kegg_mmu04611_parsed,
                path = "//relation", 
                fun = xmlGetAttr, 
                name = relation
            ))
    relation_df <- rbind(relation_df, x)
}

relation_df <- relation_df %>% t() %>% 
    as.data.frame() %>% 
    magrittr::set_rownames(value = NULL) %>% 
    magrittr::set_colnames(value = c("entry1", "entry2", "type"))
```


```{r}
sub_names <- c("name", "value")
sub_df <- data.frame()
for(sub_name in sub_names){
    x <- do.call(what = "xpathSApply", 
            args = list(
                doc = kegg_mmu04611_parsed,
                path = "//relation/subtype", 
                fun = xmlGetAttr, 
                name = sub_name
            ))
    sub_df <- rbind(sub_df, x)
}

sub_df <- sub_df %>% t() %>% 
    as.data.frame() %>% 
    magrittr::set_rownames(value = NULL) %>% 
    magrittr::set_colnames(value = c("type_name", "type_value"))
```


## map p2ry12 onto reactome pathway  
```{r}
reactome.db::reactome_dbInfo()
```

```{r}
reactome_pathway_p2r12 <- reactomePATHID2EXTID %>% 
    as.data.frame() %>% 
    dplyr::filter(gene_id == "70839") %>% 
    pull(DB_ID) %>% 
    unique()
```

```{r}
library(DBI)

dbListTables(conn = reactome_dbconn())
```

