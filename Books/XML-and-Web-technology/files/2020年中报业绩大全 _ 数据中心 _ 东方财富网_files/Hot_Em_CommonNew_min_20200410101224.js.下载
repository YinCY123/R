$(function(){JsLoader=function(sUrl,fCallback,encode){var _script=document.createElement("script");_script.setAttribute("type","text/javascript");if(!encode)_script.setAttribute("charset","utf-8");else _script.setAttribute("charset",encode);_script.setAttribute("src",sUrl);document.getElementsByTagName("head")[0].appendChild(_script);if(_script.addEventListener){_script.onload=function(){_script.parentNode.removeChild(_script);if(fCallback)fCallback()}}else if(_script.readyState){_script.onreadystatechange=function(){if(_script.readyState=="loaded"||_script.readyState=="complete"){_script.onreadystatechange=null;_script.parentNode.removeChild(_script);if(fCallback)fCallback()}}}else{_script.parentNode.removeChild(_script)}};var changeGDLC=function(type){$(".xtitle").each(function(){var _target=$(this);var _ftype=_target.attr("data-type");if(_ftype=="5"||_ftype=="6"){var _name=_target.children(".xname");var name=_name.html();if(name.length>0){var face="****"+name.substr(name.length-2,2);_name.html(face);_target.attr("title",face)}_target.children(".xdata").html(type==1?"登录可见":type==2?"认证可见":"评测可见")}})};var login={loadURL:"https://sso.1234567.com.cn/FundTradeLoginState.aspx",tradeURL:"https://api.fund.eastmoney.com/Trade/GetTradeUserInfo?callback=?",loadData:function(){var _this=this;var ltoken=_this.getCookie("LToken");if(typeof customer!="undefined"&&customer&&""!==customer.CustomerNo&&""!==customer.CustomerName){_this.initHtml()}else{var cookieName="FundWebTradeUserInfo";var info=_this.getCookie(cookieName);if(ltoken&&ltoken!=""&&info&&window.atob){window.customer=JSON.parse(_this.base64Decode(info))}if(typeof customer!="undefined"&&customer&&""!==customer.CustomerNo&&""!==customer.CustomerName){_this.initHtml()}else{JsLoader(_this.loadURL+"?lt="+ltoken+"&v="+Math.random(),function(){if(typeof customer!="undefined"&&customer&&""!==customer.CustomerNo&&""!==customer.CustomerName){_this.initHtml()}else{$.getJSON(_this.tradeURL,function(data){window.customer=data;_this.initHtml()})}})}}},initHtml:function(){var _this=this;if(window.btoa&&typeof customer!="undefined"&&customer&&""!==customer.CustomerNo&&""!==customer.CustomerName){var cookieName="FundWebTradeUserInfo";var domain=".eastmoney.com";_this.setCookie(cookieName,_this.base64Encode(JSON.stringify(customer)),domain,120)}if(typeof customer!="undefined"&&customer&&""!==customer.CustomerNo&&""!==customer.CustomerName){if(customer.IsVisitor.length==0||customer.Risk.length==0){changeGDLC(1)}else if(customer.IsVisitor.length>0&&customer.IsVisitor.toLowerCase()=="true"){changeGDLC(2)}else if(customer.IsVisitor.length>0&&customer.IsVisitor.toLowerCase()=="false"&&(customer.Risk.length>0&&customer.Risk=="0")){changeGDLC(3)}}else{changeGDLC(1)}},setCookie:function(name,value,domain,minutes){var $this=this;var exp=new Date;exp.setTime(exp.getTime()+minutes*60*1e3);document.cookie=name+"="+escape(value)+";path=/;expires="+exp.toGMTString()+(domain?";domain="+domain:"")},getCookie:function(name){var $this=this;var arrStr=document.cookie.split("; ");var temp;if(!name){return"Allcookies: "+arrStr}else{for(var i=0;i<arrStr.length;i++){temp=arrStr[i].split("=");if(temp[0]===name)return unescape(temp[1])}}return""},base64Encode:function(str){var encode=encodeURI(str);var base64=btoa(encode);return base64},base64Decode:function(base64){var decode=atob(base64);var str=decodeURI(decode);return str},init:function(){this.loadData()}};login.init()});