---
title: "R Packages"
author: "yincy"
date: "8/22/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


**Philosophy**  
- anything that can be automated should be automated.  
- Do as little as possible by hand.  
- Do as much as possible with functions.  


**package component**  

- `R code`  
- `package metadata`  
- `Documentation`  
- `Vignettes`  
- `Tests`  
- `Namespace`  
- `External data`  
- `Compile code`  
- `Other components`: `demo/`, `exec/`, `po/` and `tools`.  



# Chapter 2 The Whole game  
## Load devtools and friends  
```{r, message=FALSE, warning=FALSE}
library(devtools)
packageVersion("devtools")

library(tidyverse)
library(fs)
```


## Toy package: foofactors  
We use various functions from devtools to build a small toy package from scratch, with features commonly seen in released packages:  

- Functions to address a specific need, such as helpers to work with factors.  
- Access to established workflows for installation, getting help, and checking basic quality.  
- Version control and an open development process.  
    + This is completely optional in your work, but recommended. You'll see how Git and GitHub helps us expose all the intermediate stages of our package.  
- Documentation fro individual functions vis `roxygen2`.  
- Unit testing with `testthat`.  
- Documentation for the package as a whole via an executable `README.Rmd`.  

We call the package **foofactors** and it will have a couple functions for handling factors. Please note that these functions are super simple and definitely not the point! For a proper package fro actor handling, please see `forcats`.  


## Peek at the finished product  
The foofactors package is tracked during its development with the Git version control system. This is purely optional and you can certainly follow along without implementing this. A nice side benefit is that we eventually connect it to a remote repository on GitHub, which means you can see the glorious result we are working towards by visiting foofactors on GitHub: https://github.com/jennybc/foofactors. By inspecting the commit history and especially the diffs, you can see exactly what changes at each step of the process laid out below.  


## `create_package()`  
Call `create_package()` to initialize a new package in a directory on your computer (and create the directory, if necessary).  

Make a deliberate choice about where to create this package on your computer. It should probably be somewhere within your home directory, alongside your other R projects. It should not be nested inside another RStudio Project, R package, or Git repo. Nor should it be in an R package library, which holds packages that have already been built and installed. The conversion of the source package we are creating here into an installed package is part of what devtools facilitates. Don't try to do devtools' job for it!   
Substitue your chosen path into a `create_package()` call like this:  
```{r}
create_package(path = "f:/git/foofactors")
```

We have to work in a temp directory, because this book is built non-interactively, in the cloud. Behind the scenes, we're executing our own `create_package()` command.  


`.Rbuildignore` lists files that need to have around but that should not be included when building the R package from source.  

- `.gitignore` anticipates Git usage and ignores some standard, behind-the-scenes  files created by R and RStudio. Even if you do not plan to use Git, this is harmless.  

- `DESCRIPTION` provides *metadata about your package*.  

- `NAMESPACE` declares the functions your package exports for external use and the external functions your package imports from other packages. At this point, it is empty, except for a comment declaring that this is a file we will not edit by hand.  

- `foofactors.Rproj` is the file that makes this directory an RStudio Project. Even if you don't use RStudio, this file is harmless. Or you can suppress its creation with `create_package(..., rstudio = F)`  

- `R/` directory is the 'business end' of your package. It will soon contain `.R` files with function definitions.  


## `use_git()`  






























